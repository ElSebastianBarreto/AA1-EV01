<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Servicios</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<body>
    <div class="container">
        <h1 th:text="${servicio.titulo}"></h1>
        <p th:text="${servicio.descripcion}"></p>
        <p><strong>Duración:</strong> <span th:text="${servicio.duracion}"></span> minutos</p>
        <p><strong>Precio:</strong> $<span th:text="${servicio.precio}"></span></p>
    </div>

    <div class="container-fluid" sec:authorize="isAuthenticated()">
        <div class="row">
            <div class="col-9">
                <div class="container">
                    <h1>Cédula: <span th:text="${cedula}"></span></h1>
                    <h1>Nombre: <span th:text="${nombre}"></span></h1>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-4" th:each="cita : ${citas}">
            <div class="card mb-4">
                <ul>
                    <li><span class="card-title text-start">Cita ID: <span th:text="${cita.idcita}"></span></span></li>
                    <li><span class="card-text">Fecha: <span th:text="${cita.fecha}"></span></span></li>
                    <li><span class="card-text">Hora inicio: <span th:text="${cita.horainicio}"></span></span></li>
                    <li><span class="card-text">Descripción del Servicio: <span th:text="${cita.servicio.titulo}"></span></span></li>
                    <li><span class="card-text">Nombre Barbero: <span th:text="${cita.barbero.nombre}"></span></span></li>
                </ul>
            </div>
        </div>
    </div>

    <div class="container mt-4">
        <h2>Filtrar por Fecha</h2>
        <select id="fechaFiltro" class="form-select"></select>
    </div>

    <div class="container mt-4">
        <h2>Seleccionar Hora</h2>
        <select id="horaFiltro" class="form-select"></select>
        <button class="btn btn-primary mt-3" onclick="redirigir()">Seleccionar Hora</button>
    </div>

    <script th:inline="javascript">
        function generarMenuFechas() {
            const fechaFiltro = document.getElementById('fechaFiltro');
            const hoy = new Date();
            const diasParaMostrar = 30;

            for (let i = 0; i < diasParaMostrar; i++) {
                const fecha = new Date(hoy);
                fecha.setDate(hoy.getDate() + i);

                const dia = fecha.getDate().toString().padStart(2, '0');
                const mes = (fecha.getMonth() + 1).toString().padStart(2, '0');
                const año = fecha.getFullYear();

                const fechaFormateada = `${año}-${mes}-${dia}`;
                const fechaVisible = `${dia}/${mes}/${año}`;

                const opcion = document.createElement('option');
                opcion.value = fechaFormateada;
                opcion.textContent = fechaVisible;

                fechaFiltro.appendChild(opcion);
            }
        }

        function generarMenuHoras() {
            const horaFiltro = document.getElementById('horaFiltro');
            horaFiltro.innerHTML = ''; // Limpiar las opciones anteriores

            const fechaSeleccionada = document.getElementById('fechaFiltro').value;
            const hoy = new Date();
            const fechaActual = `${hoy.getFullYear()}-${(hoy.getMonth() + 1).toString().padStart(2, '0')}-${hoy.getDate().toString().padStart(2, '0')}`;
            const ahora = new Date();
            const horaActual = ahora.getHours();
            const minutoActual = ahora.getMinutes();
            const inicioHora = 8;
            const finHora = 21;

            for (let h = inicioHora; h <= finHora; h++) {
                for (let m = 0; m < 60; m += 30) {
                    if (fechaSeleccionada === fechaActual) {
                        // Si es hoy, mostrar solo las horas futuras
                        if (h > horaActual || (h === horaActual && m > minutoActual)) {
                            const hora = h.toString().padStart(2, '0');
                            const minuto = m.toString().padStart(2, '0');
                            const opcion = document.createElement('option');
                            opcion.value = `${hora}:${minuto}`;
                            opcion.textContent = `${hora}:${minuto}`;
                            horaFiltro.appendChild(opcion);
                        }
                    } else {
                        // Si es una fecha futura, mostrar todas las horas desde el inicio
                        const hora = h.toString().padStart(2, '0');
                        const minuto = m.toString().padStart(2, '0');
                        const opcion = document.createElement('option');
                        opcion.value = `${hora}:${minuto}`;
                        opcion.textContent = `${hora}:${minuto}`;
                        horaFiltro.appendChild(opcion);
                    }
                }
            }
        }

        document.getElementById('fechaFiltro').addEventListener('change', generarMenuHoras);


        function redirigir() {
            const fechaSeleccionada = document.getElementById('fechaFiltro').value;
            const horaSeleccionada = document.getElementById('horaFiltro').value;
            const idServicio = /*[[${servicio.idservicio}]]*/; // Obtén el ID del servicio
            window.location.href = `/seleccionHora/${idServicio}?fecha=${fechaSeleccionada}&hora=${horaSeleccionada}`;
        }

        document.addEventListener('DOMContentLoaded', () => {
            generarMenuFechas();
            generarMenuHoras();
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>

